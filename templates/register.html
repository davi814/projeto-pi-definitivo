{% extends "base.html" %}

{% block title %}Cadastro - ServiçosPro{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="auth-container">
            <div class="auth-card">
                <h2>Criar Conta</h2>
                <p class="subtitle">Cadastre-se para começar</p>
                
                <form method="POST" action="{{ url_for('register') }}" id="registerForm">
                    <div class="form-group">
                        <label for="user_type">Tipo de Conta</label>
                        <select id="user_type" name="user_type" required class="form-input">
                            <option value="client">Cliente - Busco Profissionais</option>
                            <option value="professional">Profissional - Ofereço Serviços</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="name">Nome Completo</label>
                        <input type="text" id="name" name="name" required class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label for="cpf">CPF <i class="fas fa-shield-alt text-muted"></i></label>
                        <input type="text" id="cpf" name="cpf" required class="form-input" maxlength="14" placeholder="000.000.000-00">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Telefone</label>
                        <input type="tel" id="phone" name="phone" class="form-input" placeholder="(00) 00000-0000">
                    </div>
                    
                    <div class="form-group">
                        <label for="cep">CEP <i class="fas fa-shield-alt text-muted"></i></label>
                        <input type="text" id="cep" name="cep" required class="form-input" maxlength="9" placeholder="00000-000">
                        <small id="cep-loading" style="display: none;">Buscando endereço...</small>
                        <small id="cep-address"></small>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Senha</label>
                        <input type="password" id="password" name="password" required class="form-input" minlength="6">
                    </div>
                    
                    <button type="submit" class="btn-primary btn-block">Cadastrar</button>
                </form>
                
                <div class="auth-footer">
                    <p>Já tem uma conta? <a href="{{ url_for('login') }}">Entrar</a></p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.getElementById('cpf').addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length <= 11) {
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        e.target.value = value;
    }
});

document.getElementById('phone').addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length <= 11) {
        value = value.replace(/(\d{2})(\d)/, '($1) $2');
        value = value.replace(/(\d{5})(\d)/, '$1-$2');
        e.target.value = value;
    }
});

document.getElementById('cep').addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length <= 8) {
        value = value.replace(/(\d{5})(\d)/, '$1-$2');
        e.target.value = value;
    }
});

document.getElementById('cep').addEventListener('blur', function (e) {
    const cep = e.target.value.replace(/\D/g, '');
    if (cep.length === 8) {
        document.getElementById('cep-loading').style.display = 'block';
        document.getElementById('cep-address').textContent = '';
        
        fetch(`/api/validar-cep/${cep}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('cep-loading').style.display = 'none';
                if (data.error) {
                    document.getElementById('cep-address').textContent = 'CEP inválido';
                    document.getElementById('cep-address').style.color = 'red';
                } else {
                    document.getElementById('cep-address').textContent = `${data.address}, ${data.neighborhood} - ${data.city}/${data.state}`;
                    document.getElementById('cep-address').style.color = 'green';
                }
            })
            .catch(() => {
                document.getElementById('cep-loading').style.display = 'none';
                document.getElementById('cep-address').textContent = 'Erro ao validar CEP';
                document.getElementById('cep-address').style.color = 'red';
            });
    }
});
</script>
{% endblock %}
